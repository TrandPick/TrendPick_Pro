<!DOCTYPE html>
<html layout:decorate="~{trendpick/usr/layout/layout.html}" xmlns:layout="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>쿠폰발급</title>
</head>
<body>
<main class="min-h-screen flex flex-col" layout:fragment="main">
    <h1 class="text-center text-5xl font-bold mb-6" th:text="${storeName} + ' 쿠폰 발급관'"></h1>

    <form th:action="@{/trendpick/coupons/{storeName}/generate(storeName=${storeName})}" method="post" th:object="${couponForm}">
        <div class="mb-4">
            <label for="name" class="block mb-2">쿠폰 이름:</label>
            <input type="text" id="name" name="name" required th:field="*{name}" class="border border-gray-300 px-4 py-2 rounded-md w-full">
            <p th:if="${#fields.hasErrors('name')}" th:errors="*{name}" class="text-red-500"></p>
        </div>
        <div class="mb-4">
            <label for="limitCount" class="block mb-2">제한 수량:</label>
            <input type="number" id="limitCount" name="limitCount" required min="100" th:field="*{limitCount}" class="border border-gray-300 px-4 py-2 rounded-md w-full">
            <p th:if="${#fields.hasErrors('limitCount')}" th:errors="*{limitCount}" class="text-red-500"></p>
        </div>
        <div class="mb-4">
            <label for="discountPercent" class="block mb-2">할인률 (%):</label>
            <input type="number" id="discountPercent" name="discountPercent" required min="5" max="95" th:field="*{discountPercent}" class="border border-gray-300 px-4 py-2 rounded-md w-full">
            <p th:if="${#fields.hasErrors('discountPercent')}" th:errors="*{discountPercent}" class="text-red-500"></p>
        </div>
        <div class="mb-4">
            <label for="startDate" class="block mb-2">시작 날짜:</label>
            <input type="datetime-local" id="startDate" name="startDate" required th:field="*{startDate}" class="border border-gray-300 px-4 py-2 rounded-md w-full">
            <p th:if="${#fields.hasErrors('startDate')}" th:errors="*{startDate}" class="text-red-500"></p>
        </div>
        <div class="mb-4">
            <label for="endDate" class="block mb-2">마감 날짜:</label>
            <input type="datetime-local" id="endDate" name="endDate" required th:field="*{endDate}" class="border border-gray-300 px-4 py-2 rounded-md w-full">
            <p th:if="${#fields.hasErrors('endDate')}" th:errors="*{endDate}" class="text-red-500"></p>
        </div>
        <div class="mt-8">
            <button type="submit" class="bg-blue-500 text-white py-2 px-4 rounded-md">쿠폰 생성</button>
        </div>
    </form>

    <script>
        window.addEventListener('DOMContentLoaded', function() {
            var startDateInput = document.getElementById('startDate');
            var endDateInput = document.getElementById('endDate');
            var submitButton = document.getElementById('submitButton');

            // 다음 날 오전 0시의 Date 객체 생성 (한국 시간대 기준)
            var tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);

            // UTC 기준의 시간을 한국 시간대로 변환
            var timezoneOffset = tomorrow.getTimezoneOffset() * 60000;
            tomorrow = new Date(tomorrow.getTime() + timezoneOffset);

            // 시작 날짜 필드에 기본값으로 다음 날 0시 설정 (한국 시간대 기준)
            startDateInput.value = tomorrow.toISOString().slice(0, 16);

            // 날짜 선택 이벤트 처리
            startDateInput.addEventListener('change', function() {
                var selectedDate = new Date(this.value);
                var today = new Date();
                today.setHours(0, 0, 0, 0);

                if (selectedDate < tomorrow) {
                    toast.error('쿠폰 발급은 다음날 0시 0분부터 가능합니다.');
                    this.value = tomorrow.toISOString().slice(0, 16);
                    endDateInput.value = '';
                    submitButton.disabled = true;
                } else {
                    submitButton.disabled = false;
                }
            });

            endDateInput.addEventListener('change', function() {
                submitButton.disabled = false;
            });
        });
    </script>
</main>
</body>
</html>