<!DOCTYPE html>
<html layout:decorate="~{trendpick/usr/layout/layout.html}" xmlns:layout="http://www.w3.org/1999/xhtml"
      xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <title th:text="'TrendPick | ' + ${mainCategoryName}"></title>
</head>
<body>
<main layout:fragment="main" class="bg-white">
    <div th:if="${mainCategoryName} != '추천'" class="flex flex-row flex-wrap bg-gray-200 p-2 rounded">
        <a th:href="@{/trendpick/products/list(main-category=${mainCategoryName},sub-category='전체')}"
           th:text="전체"
           class="mx-1 my-1 px-2 py-1 bg-gray-300 rounded-full text-sm font-medium text-gray-700 hover:bg-gray-400">
        </a>
        <a th:each="subCategory : ${subCategories}"
           th:href="@{/trendpick/products/list(main-category=${mainCategoryName},sub-category=${subCategory.name})}"
           th:text="${subCategory.name}"
           class="mx-1 my-1 px-2 py-1 bg-gray-300 rounded-full text-sm font-medium text-gray-700 hover:bg-gray-400">
        </a>
    </div>
    <div class="grid grid-flow-row-dense grid-cols-6 gap-4 m-4">
        <div th:if="${mainCategoryName} != '추천' and ${@rq.CheckLoginHtml()} and ${@rq.CheckAdminHtml()}" class="card bordered cursor-pointer flex justify-center items-center" th:onclick="'window.location=\'/trendpick/products/register\';'">
            <figure class="p-8">
                <span class="text-lg font-bold">새 상품 생성</span>
            </figure>
        </div>
        <div th:each="product, stat : ${productResponses}" class="grid gap-4" style="grid-template-columns: auto 1fr;">
            <div th:if="${mainCategoryName} == '추천'" class="flex-none bg-gray-200 text-gray-800 text-center rounded-full w-8 h-8 flex items-center justify-center">
                <span th:text="${stat.index+1}"></span>
            </div>
            <div class="card bordered flex-grow" th:href="@{/trendpick/products/{id}(id=${product.id})}">
                <figure>
                    <a th:href="@{/trendpick/products/{id}(id=${product.id})}">
                        <img th:src="|https://kr.object.ncloudstorage.com/trendpick/${product.mainFile}|" alt="Product Image"/>
                    </a>
                </figure>
                <div class="card-body">
                    <a th:href="@{/trendpick/products/{id}(id=${product.id})}">
                        <h2 class="text-lg font-bold" th:text="${product.name}"></h2>
                        <div class="badge">Brand: <span th:text="${product.brand}"></span></div>
                        <div><span class="text-orange-600 font-bold" th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' 원'"></span></div>
                    </a>
                    <div class="justify-end card-actions">
                        <div sec:authorize="isAuthenticated()">
                            <div th:if="${@rq.CheckLoginHtml()}">
                                <div th:if="${@rq.getBrandName()} == ${product.brand}" class="card-actions flex justify-between">
                                    <div class="w-1/2">
                                        <a th:href="@{/trendpick/products/edit/{productId}(productId=${product.id})}" class="justify-center btn btn-accent btn-sm">Edit</a>
                                    </div>
                                    <div class="w-1/2">
                                        <a href="javascript:;" onclick="if (confirm('정말로 삭제하시겠습니까?')) $(this).next().submit();" class="justify-center btn btn-accent btn-sm">Delete</a>
                                        <form hidden th:action="|/trendpick/products/${product.id}|" method="post">
                                            <input type="hidden" name="_method" value="delete"/>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="flex justify-center my-4" th:if="${productResponses != null and not #lists.isEmpty(productResponses.content)}">
        <div class="btn-group">
            <a th:if="${productResponses.hasPrevious()}" th:href="@{|/trendpick/products/list?main-category=${mainCategoryName}&sub-category=${subCategoryName}&page=${productResponses.number - 1}|}" class="btn">Previous</a>
            <span th:each="i : ${#numbers.sequence(0, productResponses.totalPages - 1)}" th:if="${i >= (productResponses.number - 3) && i <= (productResponses.number + 3)}">
                <a th:href="@{|/trendpick/products/list?main-category=${mainCategoryName}&sub-category=${subCategoryName}&page=${i}|}" th:text="${i+1}" th:class="${productResponses.number == i ? 'btn btn-active' : 'btn'}"></a>
            </span>
            <a th:if="${productResponses.hasNext()}" th:href="@{|/trendpick/products/list?main-category=${mainCategoryName}&sub-category=${subCategoryName}&page=${productResponses.number + 1}|}" class="btn">Next</a>
        </div>
    </div>

</main>

</body>
</html>